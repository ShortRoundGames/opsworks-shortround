[general]
# Path to the AWSLogs agent's state file. Agent uses this file to maintain
# client side state across its executions.
state_file = /var/awslogs/state/agent-state

# add the log entries
if (node[:opsworks])
	//Go through each layer of this instance and check for cloudwatch setups
	node["opsworks"]["instance"]["layers"].each do |layerName|
		log layerName
		if (node[:cloudwatch_logs][layerName])
		
			# Each log file is defined in its own section. The section name doesn't
			# matter as long as its unique within this file.
			[<%= node[:opsworks][:stack][:name] + layerName%>]
			datetime_format = [%Y-%m-%d %H:%M:%S]
			
			# A Log Group is a group of Log Streams that share the same properties, 
			# policies, and access controls. We just use the stack name.
			log_group_name = <%= node[:opsworks][:stack][:name].gsub(' ', '_') %>
			
			# The file to monitor is pulled from the custom json.
			file = <%= node[:cloudwatch_logs][layerName][:file] %>
			
			# A Log Stream is a sequence of Log Events from the same source.
			log_stream_name = <%= node[:opsworks][:instance][:hostname] + node[:cloudwatch_logs][layerName][:stream] %>				
		end
	end
end


